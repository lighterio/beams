!function(n){var t=function(){},e=t,r=t,i=function(){var t=n.XMLHttpRequest,e=n.ActiveXObject;return t?new t:e?new e("Microsoft.XMLHTTP"):!1},o=function(n,t,u,c){I(t)&&(c=u,u=t,t=0);var f=i();return f&&(c=c||r,u=u||e,f.onreadystatechange=function(){if(4==f.readyState){_('[Jymin] Received response from "'+n+'". ('+o._WAITING+" in progress)."),--o._WAITING;var t=f.status,i=200==t,a=i?u||e:c||r,s=parse(f.responseText);s._STATUS=t,s._REQUEST=f,a(s)}},f.open(t?"POST":"GET",n,!0),f.setRequestHeader("x-requested-with","XMLHttpRequest"),t&&f.setRequestHeader("content-type","application/x-www-form-urlencoded"),f._URL=n,t&&(f._BODY=t),f._TIME=a(),o._WAITING=(o._WAITING||0)+1,_('[Jymin] Sending request to "'+n+'". ('+o._WAITING+" in progress)."),f.send(t||null)),!0},u=function(n,t){if(n)for(var e=0,r=c(n);r>e;e++){var i=t(n[e],e,n);if(i===!1)break}},c=function(n){return S(n)||l(n)?n.length:0},f=function(n,t){return v(n)&&n.push(t),t},a=function(n){return n=n||new Date,n.getTime()},s={_ON:function(n,t){var e=this,r=e._EVENTS||(e._EVENTS={}),i=r[n]||(r[n]=[]);return i.push(t),e},_ONCE:function(n,t){function e(){t.apply(r,arguments),r._REMOVE_LISTENER(n,e)}var r=this;return r._ON(n,e),r},_EMIT:function(n){var t=this,e=t._LISTENERS(n),r=Array.prototype.slice.call(arguments,1);return u(e,function(n){n.apply(t,r)}),t},_LISTENERS:function(n){var t=this,e=t._EVENTS||0,r=e[n]||[];return r},_REMOVE_LISTENER:function(n,t){var e=this,r=e._LISTENERS(n),i=r.indexOf(t);return i>-1&&r.splice(i,1),e},_REMOVE_ALL_LISTENERS:function(n){var t=this,e=t._EVENTS||{};if(n)delete e[n];else for(n in e)delete e[n];return t}},E=function(){T("error",arguments)},_=function(){T("log",arguments)},T=function(t,e){var r=n.console;r&&r[t]&&r[t].apply(r,e)},d=function(n,t){if(n)for(var e in n){var r=t(e,n[e],n);if(r===!1)break}},m=function(n,t){return n&&t&&d(t,function(t,e){n[t]=e}),n},N=function(n){return encodeURIComponent(n)},p=function(n,t){return typeof n==t},l=function(n){return p(n,"string")},I=function(n){return p(n,"function")},S=function(n,t){return n instanceof(t||Object)},v=function(n){return S(n,Array)},g=1e3,R=function(){function e(){_('[Beams] Polling for messages at "'+d+'".'),o(d,r,i)}function r(n){u(n,function(n){var t=n[0],e=n[1];c(t,e)}),addTimeout(R,e,0)}function i(){addTimeout(R,e,g),E('[Beams] Failed to connect to "'+d+'".')}function c(n,t){_('[Beams] Received "'+n+'": '+stringify(t)+"."),u(l[n],function(e){I(e)?e.call(R,t):E('[Beams] Handler for "'+n+'" is not a function: '+stringify(e)+".")})}function a(n){R._ID=n.id,d=T+"?id="+R._ID,_('[Beams] Set endpoint URL to "'+d+'".'),u(p,function(n){n()}),p=[]}if(n.Beams=R,R._ON)return R;_("[Beams] Initializing client.");var T="/beam",d=T,p=[],l=R._EVENTS={},S=!1;onReady(function(){S&&(l=R._EVENTS={connect:a}),S=!0}),m(R,s);var v=0;return R._ON=function(n,t){_('[Beams] Listening for "'+n+'".');var e=l[n]||(l[n]=[]);return f(e,t),R},R._CONNECT=function(n){return R._ON("connect",n),R},R._EMIT=function(n,e){function r(){o(d+"&m="+N(n)+"&n="+v,"d="+N(e),t,function(){setTimeout(r,g)})}return e=stringify(e||{},1),_('[Beams] Emitting "'+n+'": '+e+"."),v++,R._ID?r():p.push(r),R},R._CONNECT(a),e(),R};n.Beams=R}(window);