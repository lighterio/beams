!function(n){var t=function(){},e=t,i=t,r=function(t,o,u,c,a){isFunction(o)&&(a=c,c=u,u=o,o=0);var f;if(n.XMLHttpRequest)f=new XMLHttpRequest;else{if(!n.ActiveXObject)return!1;f=new ActiveXObject("Microsoft.XMLHTTP")}return f&&(f.onreadystatechange=function(){if(4==f.readyState){--r._WAITING;var t=f.status,o=200==t,T=o?u||e:c||i,d=f.responseText;if(a){var v;if(t)try{var _=n.eval;_("eval.J="+d),v=_.J}catch(_){s('Could not parse JSON: "'+d+'"'),v={_ERROR:"_BAD_JSON",_TEXT:d}}else v={_ERROR:"_OFFLINE"};v._STATUS=t,v.request=f,d=v}T(d,f)}},f.open(o?"POST":"GET",t,!0),f.setRequestHeader("x-requested-with","XMLHttpRequest"),o&&f.setRequestHeader("content-type","application/x-www-form-urlencoded"),r._WAITING=(r._WAITING||0)+1,f.url=t,o&&(f.body=o),f._TIME=new Date,f.send(o||null)),!0},o=function(n,t){if(n)for(var e=0,i=a(n);i>e;e++){var r=t(n[e],e,n);if(r===!1)break}},u=function(n,t){if(n)for(var e in n){var i=t(n[e],e,n);if(i===!1)break}},c=function(n,t){return n&&t&&u(t,function(t,e){n[e]=t}),n},a=function(n){return isInstance(n)||isString(n)?n.length:0},f=function(n,t){return isArray(n)&&n.push(t),t},s=function(){T("error",arguments)},T=function(t,e){var i=n.console;i&&i[t]&&i[t].apply(i,e)},d=1e3,v=function(){function n(){r(a,0,function(t){o(t,function(n){var t=n[0],i=n[1];e(t,i)}),addTimeout(v,n,0)},function(){s("Beams: Failed to connect ("+a+")."),addTimeout(v,n,d)},1)}function e(n,t){o(_[n],function(n){n.call(i,t)})}var i=v._CLIENT;if(i)return i;var u="/beam",a=u,T=[],_={},l=!1;onReady(function(){l&&(_={}),l=!0});var p=0;return i=v._CLIENT={},i._CONNECT=i.connect=function(n){return this._ON("connect",n),i},i._ON=i.on=function(n,t){var e=_[n];return e||(e=_[n]=[]),f(e,t),i},i._EMIT=i.emit=function(n,e){function o(){r(a+"&m="+escape(n)+"&n="+p,e||{},t,function(){setTimeout(o,d)})}return p++,i.id?o():T.push(o),i},i._CONNECT(function(n){c(i,n),a=u+"?id="+i.id,T.forEach(function(n){n()}),T=[]}),n(),i};n.Beams=v}(window);