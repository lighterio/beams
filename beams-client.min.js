!function(n){var t=function(){},e=t,r=t,i=function(t,o,u,c,a){isFunction(o)&&(a=c,c=u,u=o,o=0);var f;if(n.XMLHttpRequest)f=new XMLHttpRequest;else{if(!n.ActiveXObject)return!1;f=new ActiveXObject("Microsoft.XMLHTTP")}return f&&(f.onreadystatechange=function(){if(4==f.readyState){--i._WAITING;var t=f.status,o=200==t,T=o?u||e:c||r,v=f.responseText;if(a){var _;if(t)try{var l=n.eval;l("eval.J="+v),_=l.J}catch(l){s('Could not parse JSON: "'+v+'"'),_={_ERROR:"_BAD_JSON",_TEXT:v}}else _={_ERROR:"_OFFLINE"};_._STATUS=t,_.request=f,v=_}T(v,f)}},f.open(o?"POST":"GET",t,!0),f.setRequestHeader("x-requested-with","XMLHttpRequest"),o&&f.setRequestHeader("content-type","application/x-www-form-urlencoded"),i._WAITING=(i._WAITING||0)+1,f.url=t,o&&(f.body=o),f._TIME=new Date,f.send(o||null)),!0},o=function(n,t){if(n)for(var e=0,r=a(n);r>e;e++){var i=t(n[e],e,n);if(i===!1)break}},u=function(n,t){if(n)for(var e in n){var r=t(n[e],e,n);if(r===!1)break}},c=function(n,t){return n&&t&&u(t,function(t,e){n[e]=t}),n},a=function(n){return isInstance(n)||isString(n)?n.length:0},f=function(n,t){return isArray(n)&&n.push(t),t},s=function(){v("error",arguments)},T=function(){v("log",arguments)},v=function(t,e){var r=n.console;r&&r[t]&&r[t].apply(r,e)},_=1e3,l=function(){function n(){i(a,0,function(t){o(t,function(n){var t=n[0],r=n[1];e(t,r)}),n()},function(){T("ERROR: Failed to connect ("+a+")."),setTimeout(n,_)},1)}function e(n,t){o(v[n],function(n){n.call(r,t)})}var r=l._CLIENT;if(r)return r;var u="/beam",a=u,s=[],v={},d=!1;onReady(function(){d&&(v={}),d=!0});var R=0;return r=l._CLIENT={},r._CONNECT=r.connect=function(n){return this._ON("connect",n),r},r._ON=r.on=function(n,t){var e=v[n];return e||(e=v[n]=[]),f(e,t),r},r._EMIT=r.emit=function(n,e){function o(){i(a+"&m="+escape(n)+"&n="+R,e||{},t,function(){setTimeout(o,_)})}return R++,r.id?o():s.push(o),r},r._CONNECT(function(n){c(r,n),a=u+"?id="+r.id,s.forEach(function(n){n()}),s=[]}),n(),r};n.Beams=l}(window);