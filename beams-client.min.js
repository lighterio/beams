!function(n){var t=function(){},e=t,i=t,r=function(){var t=n.XMLHttpRequest,e=n.ActiveXObject;return t?new t:e?new e("Microsoft.XMLHTTP"):!1},o=function(n,t,u,c){p(t)&&(c=u,u=t,t=0);var f=r();return f&&(f.onreadystatechange=function(){if(4==f.readyState){--o._WAITING;var n=f.status,t=200==n,r=t?u||e:c||i,a=parse(f.responseText);a._STATUS=n,a._REQUEST=f,a=a||{_ERROR:"_OFFLINE"},r(a)}},f.open(t?"POST":"GET",n,!0),f.setRequestHeader("x-requested-with","XMLHttpRequest"),t&&f.setRequestHeader("content-type","application/x-www-form-urlencoded"),o._WAITING=(o._WAITING||0)+1,f._URL=n,t&&(f._BODY=t),f._TIME=d(),f.send(t||null)),!0},u=function(n,t){if(n)for(var e=0,i=a(n);i>e;e++){var r=t(n[e],e,n);if(r===!1)break}},c=function(n,t){if(n)for(var e in n){var i=t(e,n[e],n);if(i===!1)break}},f=function(n,t){return n&&t&&c(t,function(t,e){n[t]=e}),n},a=function(n){return N(n)||v(n)?n.length:0},s=function(n,t){return R(n)&&n.push(t),t},d=function(n){return n=n||new Date,n.getTime()},m=function(){l("error",arguments)},T=function(){l("log",arguments)},l=function(t,e){var i=n.console;i&&i[t]&&i[t].apply(i,e)},_=function(n){return encodeURIComponent(n)},g=function(n,t){return typeof n==t},v=function(n){return g(n,"string")},p=function(n){return g(n,"function")},N=function(n,t){return n instanceof(t||Object)},R=function(n){return N(n,Array)},E=1e3,I=function(){function e(){T("[Beams] Polling for messages."),o(d,i,r)}function i(n){u(n,function(n){var t=n[0],e=n[1];c(t,e)}),addTimeout(I,e,0)}function r(){addTimeout(I,e,E),m('[Beams] Failed to connect to "'+d+'".')}function c(n,t){T('[Beams] Received "'+n+'": '+stringify(t)+"."),u(g[n],function(n){n.call(I,t)})}if(n.Beams=I,I._ON)return I;T("[Beams] Initializing client.");var a="/beam",d=a,l=[],g={},v=!1;onReady(function(){v&&(g={}),v=!0});var p=0;return I._ON=I.on=function(n,t){T('[Beams] Listening for "'+n+'".');var e=g[n];return e||(e=g[n]=[]),s(e,t),I},I._HANDLE=I.handle=function(n,t){return T('[Beams] Listening for "'+n+'" with a singular handler.'),g[n]=[t],I},I._CONNECT=I.connect=function(n){return this._ON("connect",n),I},I._EMIT=I.emit=function(n,e){function i(){o(d+"&m="+_(n)+"&n="+p,"d="+_(e),t,function(){setTimeout(i,E)})}return e=stringify(e||{},0,1),T('[Beams] Emitting "'+n+'": '+e+"."),p++,I.id?i():l.push(i),I},I._CONNECT(function(n){f(I,n),d=a+"?id="+I.id,u(l,function(n){n()}),l=[]}),e(),I};n.Beams=I}(window);